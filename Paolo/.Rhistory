G2023F<- G2023 %>%
filter(!Categoria_FA %in% c("Reconsideración", "multa coercitiva", "multas coercitivas"))
G2024F<- G2024 %>%
filter(!Categoria_FA %in% c("Multa coercitiva", "Reconsideración", "Enmienda multa coercitiva",
"Medida correctiva", "Informe de enmienda"))
G2024F <- G2024F %>%
filter(!(ID == 167 & Imputacion == 4), !(ID == 179 & Imputacion == 3))
G2024F <- G2024F %>%
filter(!ID == 71)
# "Se debe eliminar por criterio del informe"
# Selecionando las variables a emplear
G2022F <- G2022F %>% dplyr::select("Informes", "Imputacion", "Factores_agravantes", "Categoria_FA", "% FA")
G2023F <- G2023F %>% dplyr::select("Informes", "Imputacion", "Factores_agravantes", "Categoria_FA", "% FA")
G2024F <- G2024F %>% dplyr::select("Informes", "Imputacion", "Factores_agravantes", "Categoria_FA", "% FA")
# Haciendo un append
FINAL <- rbind(G2022F, G2023F, G2024F)
rm(G2022,G2022F, G2023, G2023F, G2024,G2024F)
View(FINAL)
Consolidado <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Bases/dfunido.xlsx", sheet = "Sheet 1")
# Seleccionando las variables
Consolidado <- Consolidado %>% dplyr::select("Informes", "Propuesta_Multa")
Consolidado <- Consolidado %>%
filter(Propuesta_Multa == "si")
Fusion <-left_join(x = FINAL, y = Consolidado, by="Informes")
View(Consolidado)
Consolidado <- Consolidado[duplicated(Consolidado$Informes), ]
View(Consolidado)
View(Consolidado)
View(Consolidado)
Consolidado <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Bases/dfunido.xlsx", sheet = "Sheet 1")
# Seleccionando las variables
Consolidado <- Consolidado %>% dplyr::select("Informes", "Propuesta_Multa")
Consolidado <- Consolidado %>%
filter(Propuesta_Multa == "si")
Unicos <- Consolidado[duplicated(Consolidado$Informes), ]
Unicos <- data[!duplicated(Consolidado), ]
Consolidado <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Bases/dfunido.xlsx", sheet = "Sheet 1")
# Seleccionando las variables
Consolidado <- Consolidado %>% dplyr::select("Informes", "Propuesta_Multa")
Consolidado <- Consolidado %>%
filter(Propuesta_Multa == "si")
Consolidado <- Consolidado %>% dplyr::select("Informes")
Unicos <- data[!duplicated(Consolidado), ]
Unicos <- Consolidado[!duplicated(Consolidado), ]
# Cargando la base de DFUNIDO
Consolidado <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Bases/dfunido.xlsx", sheet = "Sheet 1")
# Seleccionando las variables
Consolidado <- Consolidado %>% dplyr::select("Informes", "Propuesta_Multa")
Consolidado <- Consolidado %>%
filter(Propuesta_Multa == "si")
#Consolidado <- Consolidado %>% dplyr::select("Informes")
Unicos <- Consolidado[!duplicated(Consolidado$Informes), ]
View(Unicos)
Fusion <-left_join(x = FINAL, y = Unicos, by="Informes")
Consolidado <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Bases/dfunido.xlsx", sheet = "Sheet 1")
# Seleccionando las variables
Consolidado <- Consolidado %>% dplyr::select("Informes", "Propuesta_Multa")
Consolidado <- Consolidado %>%
filter(Propuesta_Multa == "si")
#Quitando duplicados
Unicos <- Consolidado[!duplicated(Consolidado$Informes), ]
# Fusionando bases
Fusion <-left_join(x = FINAL, y = Unicos, by="Informes")
View(Fusion)
rm(list = ls())
require(pacman)
p_load(readxl, tidyverse, rio, here, dplyr, writexl)
G2022 <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Factores/Copia de Informes_2022.xlsx",
sheet = "Graduacion")
G2023 <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Factores/Copia de Informes_2023.xlsx",
sheet = "Graduacion")
G2024 <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Factores/Copia de Informes_2024.xlsx",
sheet = "Graduacion")
# Quitando de las bases las categorías a no emplear
G2022F<- G2022 %>%
filter(!Categoria_FA %in% c("Reconsideración", "Multa coercitiva", "Sin factor"))
G2022F<- G2022F %>%
filter(!Observaciones %in% c("Eliminado de la conclusió del informe de sanción por motivo específico"))
G2023F<- G2023 %>%
filter(!Categoria_FA %in% c("Reconsideración", "multa coercitiva", "multas coercitivas"))
G2024F<- G2024 %>%
filter(!Categoria_FA %in% c("Multa coercitiva", "Reconsideración", "Enmienda multa coercitiva",
"Medida correctiva", "Informe de enmienda"))
G2024F <- G2024F %>%
filter(!(ID == 167 & Imputacion == 4), !(ID == 179 & Imputacion == 3))
G2024F <- G2024F %>%
filter(!ID == 71)
# "Se debe eliminar por criterio del informe"
# Selecionando las variables a emplear
G2022F <- G2022F %>% dplyr::select("ID","Informes", "Imputacion", "Factores_agravantes", "Categoria_FA", "% FA")
G2023F <- G2023F %>% dplyr::select("ID","Informes", "Imputacion", "Factores_agravantes", "Categoria_FA", "% FA")
G2024F <- G2024F %>% dplyr::select("ID","Informes", "Imputacion", "Factores_agravantes", "Categoria_FA", "% FA")
# Haciendo un append
FINAL <- rbind(G2022F, G2023F, G2024F)
rm(G2022,G2022F, G2023, G2023F, G2024,G2024F)
# Cargando la base de DFUNIDO
Consolidado <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Bases/dfunido.xlsx", sheet = "Sheet 1")
# Seleccionando las variables
Consolidado <- Consolidado %>% dplyr::select("Informes", "Propuesta_Multa")
Consolidado <- Consolidado %>%
filter(Propuesta_Multa == "si")
#Quitando duplicados
Unicos <- Consolidado[!duplicated(Consolidado$Informes), ]
# Fusionando bases
Fusion <-left_join(x = FINAL, y = Unicos, by="Informes")
View(Fusion)
# Exportando
write_xlsx(FINAL, path = "D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Factores/Factores.xlsx")
View(Consolidado)
View(Fusion)
Fusion <- Fusion %>%
rename(Porcentaje = "% Fusion")
Fusion <- Fusion %>%
rename(Porcentaje = "% FA")
# Exportando
write_xlsx(Fusion, path = "D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Factores/Factores.xlsx")
rm(list = ls())
require(pacman)
p_load(readxl, tidyverse, rio, here, dplyr, writexl)
G2022 <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Factores/Copia de Informes_2022.xlsx",
sheet = "Graduacion")
G2023 <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Factores/Copia de Informes_2023.xlsx",
sheet = "Graduacion")
G2024 <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Factores/Copia de Informes_2024.xlsx",
sheet = "Graduacion")
# Quitando de las bases las categorías a no emplear
G2022F<- G2022 %>%
filter(!Categoria_FA %in% c("Reconsideración", "Multa coercitiva", "Sin factor"))
G2022F<- G2022F %>%
filter(!Observaciones %in% c("Eliminado de la conclusió del informe de sanción por motivo específico"))
G2023F<- G2023 %>%
filter(!Categoria_FA %in% c("Reconsideración", "multa coercitiva", "multas coercitivas"))
G2024F<- G2024 %>%
filter(!Categoria_FA %in% c("Multa coercitiva", "Reconsideración", "Enmienda multa coercitiva",
"Medida correctiva", "Informe de enmienda"))
G2024F <- G2024F %>%
filter(!(ID == 167 & Imputacion == 4), !(ID == 179 & Imputacion == 3))
G2024F <- G2024F %>%
filter(!ID == 71)
# "Se debe eliminar por criterio del informe"
# Selecionando las variables a emplear
G2022F <- G2022F %>% dplyr::select("ID","Informes", "Imputacion", "Factores_agravantes", "Categoria_FA", "% FA")
G2023F <- G2023F %>% dplyr::select("ID","Informes", "Imputacion", "Factores_agravantes", "Categoria_FA", "% FA")
G2024F <- G2024F %>% dplyr::select("ID","Informes", "Imputacion", "Factores_agravantes", "Categoria_FA", "% FA")
# Haciendo un append
FINAL <- rbind(G2022F, G2023F, G2024F)
rm(G2022,G2022F, G2023, G2023F, G2024,G2024F)
# Cargando la base de DFUNIDO
Consolidado <-read_excel("D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Bases/dfunido.xlsx", sheet = "Sheet 1")
# Seleccionando las variables
Consolidado <- Consolidado %>% dplyr::select("Informes", "Propuesta_Multa")
Consolidado <- Consolidado %>%
filter(Propuesta_Multa == "si")
#Quitando duplicados
Unicos <- Consolidado[!duplicated(Consolidado$Informes), ]
# Fusionando bases
Fusion <-left_join(x = FINAL, y = Unicos, by="Informes")
# Cambiando nombre de variable
#Fusion <- Fusion %>%
#  rename(Porcentaje = "% FA")
# Exportando
write_xlsx(Fusion, path = "D:/NUEVO D/REPOSITORIO_GITHUB/OEFA_SMER/Paolo/Scripts/Factores/Factores.xlsx")
require(pacman)
p_load(foreign, tidyverse, rio, here, dplyr, viridis, readxl, stringr, RColorBrewer, ggcorrplot,
flextable, officer, classInt, foreign, stargazer, sf, mapview, leaflet, writexl, lmtest,
tseries, car, haven, officer, xlsx, openxlsx, httr)
rm(list = ls())
# Carga de información del Consolidado 1
url1 <- "https://raw.githubusercontent.com/PaoloValcarcel/OEFA_SMER/main/Paolo/Scripts/Bases/dfunido.xlsx"
temp_file <- tempfile(fileext = ".xlsx")
GET(url1, write_disk(temp_file, overwrite = TRUE))
Consolidado <- read_excel(temp_file, sheet = "Sheet 1")
rm(temp_file, url1)
# Carga de información del Consolidado 2
url2 <- "https://raw.githubusercontent.com/PaoloValcarcel/OEFA_SMER/main/Paolo/Scripts/Bases/dfunido2.xlsx"
temp_file <- tempfile(fileext = ".xlsx")
GET(url2, write_disk(temp_file, overwrite = TRUE))
Consolidado2 <- read_excel(temp_file, sheet = "Sheet 1")
rm(temp_file, url2)
# Carga de información de RUIAS
url3 <- "https://raw.githubusercontent.com/PaoloValcarcel/OEFA_SMER/main/Paolo/Scripts/Bases/RUIAS-CSEP.xlsx"
temp_file <- tempfile(fileext = ".xlsx")
GET(url3, write_disk(temp_file, overwrite = TRUE))
RUIAS <- read_excel(temp_file, sheet = "RUIAS")
rm(temp_file, url3)
CFinal1 <- Consolidado %>%
filter(!Propuesta_Multa %in% c("si"),!Observaciones%in% c("Se debe eliminar por criterio del informe"))
colnames(CFinal1)[colnames(CFinal1) == "ID2"] <- "Index"
CFinal1$Index <- as.character(CFinal1$Index)
colnames(Consolidado2)[colnames(Consolidado2) == "ID RUIAS"] <- "Index"
colnames(Consolidado2)[colnames(Consolidado2) == "Sub extremo"] <- "Sub_extremo"
colnames(Consolidado2)[colnames(Consolidado2) == "Expedientes"] <- "Expediente"
Consolidado2$Index <- as.character(Consolidado2$Index)
CFinal1 <- CFinal1 %>% dplyr::select("ID", "Expediente", "Informes", "Hecho_imputado",
"Num_Imputacion","Sub_extremo", "Monto", "Index",
"COS_anual", "T_meses",  "Costo_evitado", "Unidad_monetaria",
"Tipo_de_cambio", "Beneficio_ilícito", "Prob_Detección",
"Multa", "Multa_Final", "Sancion_total",  "Colapsar", "year")
CFinal2 <- Consolidado2 %>% dplyr::select("ID", "Expediente", "Informes", "Hecho_imputado",
"Num_Imputacion","Sub_extremo", "Monto", "Index",
"COS_anual", "T_meses",  "Costo_evitado", "Unidad_monetaria",
"Tipo_de_cambio", "Beneficio_ilícito", "Prob_Detección",
"Multa", "Multa_Final", "Sancion_total",  "Colapsar", "year")
CFinal1$Datos <- "Primera fase"
CFinal2$Datos <- "Segunda fase"
CFinal <- rbind(CFinal1, CFinal2)
rm(CFinal1, CFinal2, Consolidado, Consolidado2)
RFinal <- RUIAS %>% dplyr::select("ID", "Administrado", "RUC", "Sector económico", "Departamento",
"Provincia", "Distrito", "Infracción cometida sancionada (Clasificación de 11)",
"Infracción cometida sancionada (Clasificación de 19)",
"Inicio de supervisión", "Fin de supervisión", "Fecha de notificación...23",
"Documento de inicio", "Fecha de emisión",
"N° de Resolución de Responsabilidad Administrativa", "Fecha de la Resolución...38",
"Fecha de notificación...39")
colnames(RFinal)[colnames(RFinal) == "ID"] <- "Index"
colnames(RFinal)[colnames(RFinal) == "Sector económico"] <- "SectorEco"
colnames(RFinal)[colnames(RFinal) == "Inicio de supervisión"] <- "InicioSup"
colnames(RFinal)[colnames(RFinal) == "Fin de supervisión"] <- "FinSup"
colnames(RFinal)[colnames(RFinal) == "Fecha de notificación...23"] <- "InicioPAS"
colnames(RFinal)[colnames(RFinal) == "Infracción cometida sancionada (Clasificación de 11)"] <- "Incumplimiento_11"
colnames(RFinal)[colnames(RFinal) == "Infracción cometida sancionada (Clasificación de 19)"] <- "Incumplimiento_19"
colnames(RFinal)[colnames(RFinal) == "Fecha de notificación...23"] <- "Fecha_Notificacion_23"
colnames(RFinal)[colnames(RFinal) == "Fecha de notificación...39"] <- "Fecha_Notificacion_39"
colnames(RFinal)[colnames(RFinal) == "Fecha de la Resolución...38"] <- "Fecha_Resolucion"
colnames(RFinal)[colnames(RFinal) == "N° de Resolución de Responsabilidad Administrativa"] <- "Nro_Resolucion"
colnames(RFinal)[colnames(RFinal) == "Documento de inicio"] <- "Documento_Inicio"
colnames(RFinal)[colnames(RFinal) == "Fecha de emisión"] <- "Fecha_Emision"
RFinal$Index <- as.character(RFinal$Index)
# Fusionando ambas bases
CFinal$Index[is.na(CFinal$Index)] <- 0
FINAL <-left_join(x = CFinal, y = RFinal, by="Index")
FINAL <- FINAL %>%
mutate(Merge = if_else(!is.na(Departamento), 1, 0))
# Eliminando los objetos que no necesitamos
rm(CFinal, RFinal, RUIAS)
# Arreglando las etiquetas de los sectores
FINAL$Sancion_total <- as.numeric(FINAL$Sancion_total)
FINAL$Multa_Final <- as.numeric(FINAL$Multa_Final)
FINAL$Prob_Detección <- as.numeric(FINAL$Prob_Detección)
FINAL$Beneficio_ilícito <- as.numeric(FINAL$Beneficio_ilícito)
FINAL$T_meses <- as.numeric(FINAL$T_meses)
FINAL <- FINAL %>%
mutate(SectorEco = tolower(SectorEco))
FINAL$SectorEco <- sapply(FINAL$SectorEco, function(x) {
paste(toupper(substr(x, 1, 1)), tolower(substr(x, 2, nchar(x))), sep = "")
})
FINAL <- FINAL %>% filter(Multa_Final != 0)
table(FINAL$Merge)
# Fusionando el Tipo de Empresa (restante: Index 7020)
url4 <- "https://raw.githubusercontent.com/PaoloValcarcel/OEFA_SMER/main/Paolo/Scripts/Bases/Tipo_Empresas.xlsx"
temp_file <- tempfile(fileext = ".xlsx")
GET(url4, write_disk(temp_file, overwrite = TRUE))
Tamaño <- read_excel(temp_file, sheet = "Final")
rm(temp_file, url4)
FINAL <-left_join(x = FINAL, y = Tamaño, by="Administrado")
rm(Tamaño)
#View(FINAL[is.na(FINAL$tipo_actividad), ])
FINAL$tipo_actividad <- ifelse(FINAL$Index == "7020", "actividad empresarial", FINAL$tipo_actividad)
FINAL$tipo_persona <- ifelse(FINAL$Index == "7020", "persona jurídica", FINAL$tipo_persona)
table(FINAL$tipo_actividad)
FINAL$Colapsar <- ifelse(FINAL$Colapsar == "Máximo", "Maximo", FINAL$Colapsar)
table(FINAL$Colapsar)
View(FINAL)
rm(list = ls())
# 2022 - Universo de 3,010
A2022 <- data.frame(Año = rep(2022, 3010))
# 2023 - Universo de 4,716
A2023 <- data.frame(Año = rep(2023, 4716))
# 2024 - Universo de 1,110
A2024 <- data.frame(Año = rep(2024, 1110))
Total <- rbind(A2022, A2023, A2024)
set.seed(1234)
Muestra <- Total[sample(nrow(Total), size = 561, replace = FALSE), ]
Muestra <- as.data.frame(Muestra)
Tabla1 <- table(Muestra$Muestra)
Tabla1_P <- round(prop.table(Tabla1) * 100,0)
Tabla1_P
set.seed(1234)
Muestra2 <- Total[sample(nrow(Total), size = 368, replace = FALSE), ]
Muestra2 <- as.data.frame(Muestra2)
Tabla2 <- table(Muestra2$Muestra)
Tabla2_P <- round(prop.table(Tabla2) * 100,0)
Tabla2_P
require(pacman)
p_load(pdftools,
stringr,
wordcloud,
tesseract,
data.table,
dplyr,
tabulapdf,
tidyverse,
ggplot2,
openxlsx)
rm(list=ls())
################################
######## PARA LOS NUEVOS #######
################################
### ---- Programando para el ASUNTO del 2024 -----###
C2024 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2024/Nuevos"
PDF_2024 <- list.files(C2024, full.names = TRUE)
PDF_2024 <- as.data.frame(PDF_2024)
Drop2024 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2024/Nuevos/"
F2024 <- sub(Drop2024, "", PDF_2024$PDF_2024)
F2024 <- as.data.frame(F2024)
rm(PDF_2024, C2024, Drop2024)
F2024$id <- 1:nrow(F2024)
Ruta_2024 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2024/Nuevos/"
leer_pdf <- function(Nombre) {
ruta_completa <- paste0(Ruta_2024, Nombre)
pdf_text(ruta_completa)
}
contenido_pdfs <- lapply(F2024$F2024, leer_pdf)
for (i in 1:length(contenido_pdfs)) {
assign(paste0("Informe_", i), contenido_pdfs[[i]])
}
Informe_72
Texto <- list()
Asunto <- lapply(1:97, function(i) get(paste0("Informe_", i)))
for (i in 1:97) {
Asunto_actual <- Asunto[[i]]
Asunto_actual <- str_replace_all(Asunto_actual, "\\s+", " ")
ASNT <- str_sub(str_extract(Asunto_actual, "(?<=ASUNTO : ).*"), 1, 45)
ASNT <- unlist(ASNT)
ASNT <- ASNT[!is.na(ASNT)]
if (length(ASNT) > 0) {
Texto[[i]] <- data.table(Correlativo = rep(i, length(ASNT)), Oracion = ASNT)
}
}
Asunto_2024N <- rbindlist(Texto)
View(Asunto_2024N)
rm(Asunto_actual, ASNT, Texto, Asunto, F2024, contenido_pdfs)
resultados <- list()
informes <- lapply(1:97, function(i) get(paste0("Informe_", i)))
for (i in 1:97) {
informe_actual <- informes[[i]]
informe_actual <- str_replace_all(informe_actual, "\\s+", " ")
informe <- str_extract(informe_actual, "(?<=INFORME N°\\s).*?(?=\\sA\\s:)")
informe <- informe[!is.na(informe)]
resultados[[i]] <- informe
}
Informes_2024N <- data.table(
Correlativo = seq_along(resultados),
Informes = unlist(lapply(resultados, function(x) ifelse(is.null(x), NA, x))))
View(Informes_2024N)
rm(informes, resultados,contenido_pdfs)
Final24N <- left_join(Informes_2024N, Asunto_2024N, by = "Correlativo")
rm(Informes_2024N, Asunto_2024N)
View(Final24N)
rm(list=ls())
################################
######## PARA LOS NUEVOS #######
################################
### ---- Programando para el ASUNTO del 2024 -----###
C2024 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2024/Nuevos"
PDF_2024 <- list.files(C2024, full.names = TRUE)
PDF_2024 <- as.data.frame(PDF_2024)
Drop2024 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2024/Nuevos/"
F2024 <- sub(Drop2024, "", PDF_2024$PDF_2024)
F2024 <- as.data.frame(F2024)
rm(PDF_2024, C2024, Drop2024)
F2024$id <- 1:nrow(F2024)
Ruta_2024 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2024/Nuevos/"
leer_pdf <- function(Nombre) {
ruta_completa <- paste0(Ruta_2024, Nombre)
pdf_text(ruta_completa)
}
contenido_pdfs <- lapply(F2024$F2024, leer_pdf)
for (i in 1:length(contenido_pdfs)) {
assign(paste0("Informe_", i), contenido_pdfs[[i]])
}
### ---- Asunto 2024 -----###
Texto <- list()
Asunto <- lapply(1:97, function(i) get(paste0("Informe_", i)))
for (i in 1:97) {
Asunto_actual <- Asunto[[i]]
Asunto_actual <- str_replace_all(Asunto_actual, "\\s+", " ")
ASNT <- str_sub(str_extract(Asunto_actual, "(?<=ASUNTO : ).*"), 1, 45)
ASNT <- unlist(ASNT)
ASNT <- ASNT[!is.na(ASNT)]
if (length(ASNT) > 0) {
Texto[[i]] <- data.table(Correlativo = rep(i, length(ASNT)), Oracion = ASNT)
}
}
Asunto_2024N <- rbindlist(Texto)
rm(Asunto_actual, ASNT, Texto, Asunto, F2024, contenido_pdfs)
### ---- Informes 2024 -----###
resultados <- list()
informes <- lapply(1:97, function(i) get(paste0("Informe_", i)))
for (i in 1:97) {
informe_actual <- informes[[i]]
informe_actual <- str_replace_all(informe_actual, "\\s+", " ")
informe <- str_extract(informe_actual, "(?<=INFORME N°\\s).*?(?=\\sA\\s:)")
informe <- informe[!is.na(informe)]
resultados[[i]] <- informe
}
Informes_2024N <- data.table(
Correlativo = seq_along(resultados),
Informes = unlist(lapply(resultados, function(x) ifelse(is.null(x), NA, x))))
rm(informes, resultados)
Final24N <- left_join(Informes_2024N, Asunto_2024N, by = "Correlativo")
rm(Informes_2024N, Asunto_2024N)
################################################################################
### ---- Programando para el ASUNTO del 2023 -----###
C2023 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2023/Nuevos"
PDF_2023 <- list.files(C2023, full.names = TRUE)
PDF_2023 <- as.data.frame(PDF_2023)
Drop2023 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2023/Nuevos/"
F2023 <- sub(Drop2023, "", PDF_2023$PDF_2023)
F2023 <- as.data.frame(F2023)
rm(PDF_2023, C2023, Drop2023)
F2023$id <- 1:nrow(F2023)
Ruta_2023 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2023/Nuevos/"
leer_pdf <- function(Nombre) {
ruta_completa <- paste0(Ruta_2023, Nombre)
pdf_text(ruta_completa)
}
contenido_pdfs <- lapply(F2023$F2023, leer_pdf)
for (i in 1:length(contenido_pdfs)) {
assign(paste0("Informe_", i), contenido_pdfs[[i]])
}
### ---- Asunto 2023 -----###
Texto <- list()
Asunto <- lapply(1:48, function(i) get(paste0("Informe_", i)))
for (i in 1:48) {
Asunto_actual <- Asunto[[i]]
Asunto_actual <- str_replace_all(Asunto_actual, "\\s+", " ")
ASNT <- str_sub(str_extract(Asunto_actual, "(?<=ASUNTO : ).*"), 1, 45)
ASNT <- unlist(ASNT)
ASNT <- ASNT[!is.na(ASNT)]
if (length(ASNT) > 0) {
Texto[[i]] <- data.table(Correlativo = rep(i, length(ASNT)), Oracion = ASNT)
}
}
Asunto_2023N <- rbindlist(Texto)
rm(Asunto_actual, ASNT, Texto, Asunto, F2023, contenido_pdfs)
### ---- Informes 2023 -----###
resultados <- list()
informes <- lapply(1:48, function(i) get(paste0("Informe_", i)))
for (i in 1:48) {
informe_actual <- informes[[i]]
informe_actual <- str_replace_all(informe_actual, "\\s+", " ")
informe <- str_extract(informe_actual, "(?<=INFORME N°\\s).*?(?=\\sA\\s:)")
informe <- informe[!is.na(informe)]
resultados[[i]] <- informe
}
Informes_2023N <- data.table(
Correlativo = seq_along(resultados),
Informes = unlist(lapply(resultados, function(x) ifelse(is.null(x), NA, x))))
rm(informes, resultados)
Final23N <- left_join(Informes_2023N, Asunto_2023N, by = "Correlativo")
rm(Informes_2023N, Asunto_2023N)
Final23N <- Final23N %>%
mutate(Informes = ifelse(Correlativo == 8, "00433-2023-OEFA/DFAI-SSAG", Informes))
Final23N <- Final23N %>%
mutate(Informes = ifelse(Correlativo == 35, "04604-2023-OEFA/DFAI-SSAG", Informes))
################################################################################
### ---- Programando para el ASUNTO del 2022 -----###
C2022 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2022/Nuevos"
PDF_2022 <- list.files(C2022, full.names = TRUE)
PDF_2022 <- as.data.frame(PDF_2022)
Drop2022 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2022/Nuevos/"
F2022 <- sub(Drop2022, "", PDF_2022$PDF_2022)
F2022 <- as.data.frame(F2022)
rm(PDF_2022, C2022, Drop2022)
F2022$id <- 1:nrow(F2022)
Ruta_2022 <- "D:/LAPTOP ACER/LOCACION OEFA/Archivos/Informes 2022/Nuevos/"
leer_pdf <- function(Nombre) {
ruta_completa <- paste0(Ruta_2022, Nombre)
pdf_text(ruta_completa)
}
contenido_pdfs <- lapply(F2022$F2022, leer_pdf)
for (i in 1:length(contenido_pdfs)) {
assign(paste0("Informe_", i), contenido_pdfs[[i]])
}
### ---- Asunto 2022 -----###
Texto <- list()
Asunto <- lapply(1:48, function(i) get(paste0("Informe_", i)))
for (i in 1:48) {
Asunto_actual <- Asunto[[i]]
Asunto_actual <- str_replace_all(Asunto_actual, "\\s+", " ")
ASNT <- str_sub(str_extract(Asunto_actual, "(?<=ASUNTO : ).*"), 1, 45)
ASNT <- unlist(ASNT)
ASNT <- ASNT[!is.na(ASNT)]
if (length(ASNT) > 0) {
Texto[[i]] <- data.table(Correlativo = rep(i, length(ASNT)), Oracion = ASNT)
}
}
Asunto_2022N <- rbindlist(Texto)
rm(Asunto_actual, ASNT, Texto, Asunto, F2022, contenido_pdfs)
### ---- Informes 2022 -----###
resultados <- list()
informes <- lapply(1:48, function(i) get(paste0("Informe_", i)))
for (i in 1:48) {
informe_actual <- informes[[i]]
informe_actual <- str_replace_all(informe_actual, "\\s+", " ")
informe <- str_extract(informe_actual, "(?<=INFORME N°\\s).*?(?=\\sA\\s:)")
informe <- informe[!is.na(informe)]
resultados[[i]] <- informe
}
Informes_2022N <- data.table(
Correlativo = seq_along(resultados),
Informes = unlist(lapply(resultados, function(x) ifelse(is.null(x), NA, x))))
rm(informes, resultados)
Final22N <- left_join(Informes_2022N, Asunto_2022N, by = "Correlativo")
rm(Informes_2022N, Asunto_2022N)
Final22N <- Final22N %>%
mutate(Informes = ifelse(Correlativo == 5, "00147-2022-OEFA/DFAI-SSAG", Informes))
Final22N <- Final22N %>%
mutate(Informes = ifelse(Correlativo == 9, "00490-2022-OEFA/DFAI-SSAG", Informes))
Final22N <- Final22N %>%
mutate(Informes = ifelse(Correlativo == 32, "01518-2022-OEFA/DFAI-SSAG", Informes))
